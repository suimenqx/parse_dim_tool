# 离线表格分析器（Smart Parser）功能设计说明书

## 文档信息

| 项目 | 内容 |
|------|------|
| 产品名称 | 离线表格分析器（Smart Parser） |
| 版本号 | v17.0 |
| 文档类型 | 功能设计说明书 |
| 编写日期 | 2025-01-10 |

---

## 1. 产品概述

### 1.1 产品定位

离线表格分析器是一款单页、纯前端的表格解析/过滤/联表工具，面向需要在无网络或安全敏感环境下快速进行数据分析、日志排查、数据对比等工作的技术人员和数据分析师。

### 1.2 核心价值

- **零依赖运行**：无需安装任何软件、无需后端服务、无需网络连接，双击 HTML 文件即可使用
- **数据安全可控**：所有数据处理完全在本地浏览器中进行，数据不离开用户设备
- **快速分析能力**：支持多格式数据解析、多维度过滤、跨表关联，无需编写 SQL
- **离线可移植**：单个 HTML 文件包含所有功能，可随身携带使用

### 1.3 适用场景

| 场景 | 描述 |
|------|------|
| 日志排查 | 从服务器复制日志文本，快速过滤错误、高亮关键信息、关联用户表 |
| 数据对比 | 对比两个时间点的数据快照，找出差异行 |
| 临时报表 | 从文本数据快速生成 Excel 报表，支持多表关联 |
| 离线分析 | 在无网络环境下进行数据分析和报表生成 |

---

## 2. 系统架构

### 2.1 技术架构

```
┌─────────────────────────────────────────────────────────────┐
│                        用户界面层                            │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  侧边栏面板   │  │  预览区域     │  │  顶部导航栏   │      │
│  │  数据源输入   │  │  表格展示     │  │  标签页管理   │      │
│  │  规则配置     │  │  交互操作     │  │  主题切换     │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
├─────────────────────────────────────────────────────────────┤
│                        功能模块层                            │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐      │
│  │ Parser   │ │ Joiner   │ │Exporter  │ │  App     │      │
│  │ 数据解析  │ │ 联表引擎 │ │ 导出模块 │ │ 主控制器 │      │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘      │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐                  │
│  │  Store   │ │JoinEditor│ │ Select   │                  │
│  │ 状态管理  │ │ 联表设计 │ │ 单元格   │                  │
│  └──────────┘ └──────────┘ └──────────┘                  │
├─────────────────────────────────────────────────────────────┤
│                      数据持久层                              │
│              localStorage (v16_4_store)                     │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 数据流向

```
用户输入 → Parser解析 → Store存储 → App处理 → UI渲染
                  ↓
            Joiner执行JOIN
                  ↓
            Exporter导出
```

---

## 3. 核心功能模块

### 3.1 数据解析模块（Parser）

#### 3.1.1 功能概述

将用户粘贴的原始文本解析为结构化的表格数据，支持多种数据格式自动识别。

#### 3.1.2 数据格式要求

**标准格式结构**：
```
table-data <表名>
validflag <列名1>    <列名2>    <列名3>
<数据1>    <数据2>    <数据3>
```

**关键规则**：
- 每张表以 `table-data <表名>` 起始
- 下一行必须以 `validflag` 开头作为表头（解析标志）
- 表头行支持多种分隔格式
- 数据行按表头列数解析
- 遇到空行或以 `<` / `[` 开头的行结束当前表

#### 3.1.3 支持的数据格式

| 格式类型 | 示例 | 识别方式 |
|---------|------|----------|
| 制表符分隔 | `ID\tName\tAge` | 包含制表符 |
| 逗号分隔 | `ID,Name,Age` | 包含逗号且无连续空格 |
| 空格分隔 | `ID Name Age` | 智能列边界检测 |
| 定宽格式 | `ID    Name      Age` | 基于表头推断列范围 |

#### 3.1.4 解析流程

1. **逐行扫描**：读取输入文本的每一行
2. **表标记检测**：识别 `table-data` 标记创建新表
3. **表头解析**：识别 `validflag` 行并确定分隔格式
4. **数据行解析**：根据格式类型分割数据
5. **表结束判断**：遇到特定标记结束当前表
6. **多表支持**：同一输入可包含多张表

#### 3.1.5 特殊处理

- **智能空格解析**：先尝试空格分割，列数不匹配时回退到检测模式
- **列名保留**：表名及列名大小写按原样保留
- **空值处理**：缺失的列自动填充为空字符串

---

### 3.2 状态管理模块（Store）

#### 3.2.1 功能概述

中央状态管理系统，负责数据持久化、标签页管理和全局配置。

#### 3.2.2 存储结构

**存储键**：`v16_4_store`（版本化以支持未来迁移）

**完整数据结构**：
```
{
  docs: [                        // 标签页文档数组
    {
      id: string,                // 标签页唯一 ID
      title: string,             // 标签页标题
      raw: string,               // 原始输入文本
      ui: {
        displayTables: string[] | null,    // 显示的原始表（null=全显）
        enabledViews: string[],            // 已启用的 JOIN 视图列表
        targetTable: string,               // 当前配置的目标表
        rules: {                           // 各表的规则配置
          [tableName]: {
            filter: string,                // 行过滤条件
            hl: string,                    // 高亮规则
            focus: string[]                // 聚焦列
          }
        },
        columnFilters: {                   // 列过滤配置
          [tableName]: {
            [columnName]: string
          }
        },
        collapsedTables: {                 // 表折叠状态
          [tableName]: boolean
        },
        enableHighlight: boolean,          // 是否启用高亮渲染
        onlyHighlighted: boolean,          // 是否仅显示高亮行
        globalFilter: string,              // 全局过滤条件
        exportOnlyChecked: boolean,        // 是否仅导出勾选表
        exportCols: string                 // 导出列选项
      }
    }
  ],
  activeId: string,              // 当前激活的标签页 ID
  theme: 'light' | 'dark',       // 主题设置
  globalViews: [                 // 全局 JOIN 视图配置
    {
      view: string,              // 视图名称
      left: string,              // 左表/视图名
      right: string,             // 右表/视图名
      type: 'inner' | 'left',    // JOIN 类型
      on: string,                // ON 条件
      select: string,            // 输出列配置
      createdAt: number,         // 创建时间戳
      updatedAt: number          // 更新时间戳
    }
  ]
}
```

#### 3.2.3 核心功能

| 功能 | 描述 |
|------|------|
| 多标签页管理 | 支持创建、切换、删除标签页 |
| 数据持久化 | 自动保存到浏览器 localStorage |
| 版本化存储 | 存储键包含版本号，支持未来数据迁移 |
| 主题管理 | 支持亮色/暗色主题切换 |
| 规则管理 | 按表存储过滤、高亮、聚焦规则 |
| UI 状态 | 记住表格折叠、列过滤等 UI 状态 |

---

### 3.3 联表执行模块（Joiner）

#### 3.3.1 功能概述

执行表或视图之间的 JOIN 操作，支持递归视图引用和循环依赖检测。

#### 3.3.2 支持的 JOIN 类型

| 类型 | 说明 | 适用场景 |
|------|------|----------|
| Inner Join | 仅保留匹配成功的行 | 查找两个表的交集 |
| Left Join | 保留左表所有行，右表不匹配列为空 | 保留主表全部数据 |

#### 3.3.3 核心能力

**递归视图引用**：
- 视图可以引用其他视图（如视图 C 引用视图 B，视图 B 引用表 A）
- 自动检测并阻止循环依赖
- 支持多层嵌套引用

**Select 令牌解析**：
- 支持格式：`left.col AS 别名` 或 `left.col : 别名`
- 支持省略 side：默认为 left
- 支持多种别名语法：`AS` 或 `:`
- 示例：`left.userName, right.product : ProductName, price`

**关联条件**：
- 多字段关联：用逗号分隔 `id=userId,name=userName`
- 自动索引匹配字段
- 支持不同表的字段关联

#### 3.3.4 执行流程

1. **表/视图解析**：递归解析左右表，可能是原始表或视图
2. **循环依赖检测**：检测引用链中是否存在循环
3. **索引构建**：为右表按关联条件构建哈希索引
4. **数据匹配**：遍历左表行，查找匹配的右表行
5. **结果生成**：根据 select 配置生成输出行
6. **统计信息**：计算匹配数、左独有、右独有等统计

#### 3.3.5 统计信息

执行后提供以下统计：
- `matched`：匹配成功的行数
- `leftOnly`：左表独有的行数
- `rightOnly`：右表独有的行数
- `outRows`：输出行数

---

### 3.4 联表设计器（JoinEditor）

#### 3.4.1 功能概述

可视化的 JOIN 视图配置界面，支持拖拽、自动匹配、批量操作等高级功能。

#### 3.4.2 界面布局

```
┌─────────────────────────────────────────────────────────┐
│  Join Designer                       [取消] [保存视图]   │
├─────────────────────────────────────────────────────────┤
│  视图名称: [____________]                                │
│  左表: [下拉选择]    右表: [下拉选择]                    │
├──────────┬───────────────────────────┬─────────────────┤
│ 左表字段  │       关联条件 (ON)       │   右表字段       │
│          │  ┌─────────────────────┐  │                 │
│          │  │ [Inner Join ▼]      │  │                 │
│ ☑ ID     │  │ [左字段] = [右字段]  │  │ ☑ ID           │
│ ☑ Name   │  │ [左字段] = [右字段]  │  │ ☑ UserName     │
│ ☐ Email  │  │ [+ 添加条件]        │  │ ☐ Email        │
│          │  └─────────────────────┘  │                 │
│ [搜索]   │                           │ [搜索]          │
│          │       输出顺序            │                 │
│          │  ┌─────────────────────┐  │                 │
│          │  │ left.ID             ↑  │                 │
│          │  │ left.Name           ↓  │                 │
│          │  │ right.UserName      ×  │                 │
│          │  └─────────────────────┘  │                 │
└──────────┴───────────────────────────┴─────────────────┘
```

#### 3.4.3 核心功能

**字段管理**：
- 字段搜索：实时过滤字段列表
- 字段全选/反选：快速选择所有字段
- 仅看已选：隐藏未选字段，简化界面
- 全选搜索结果：仅全选当前搜索结果

**关联配置**：
- 手动添加关联条件：选择左右字段进行配对
- 自动匹配：自动识别相同名称的字段并配对
- 交换左右：快速交换左右字段
- 删除条件：移除不需要的关联条件
- 字段类型检测：显示字段类型（文本/数值/日期）和示例值

**输出列管理**：
- 拖拽排序：拖动列卡片调整顺序
- 设置别名：为输出列设置自定义名称
- 上移/下移：精确调整列顺序
- 移除列：从输出中删除该列
- 重建：根据选中字段重建输出顺序
- 清空：清空所有输出列
- 只保留左/右：仅保留左表或右表的列
- 显示/隐藏：控制左表列或右表列的显示

**视图管理**：
- 新增视图：创建新的 JOIN 配置
- 编辑视图：修改现有视图配置
- 复制视图：基于现有视图创建副本
- 删除视图：删除不需要的视图
- 导入视图：粘贴 JSON 配置导入
- 导出视图：导出视图配置为 JSON

**批量操作**：
- 搜索过滤：按视图名称、表名、关联条件搜索
- 全选/取消全选：批量选择视图
- 批量导出：导出多个视图配置
- 批量删除：删除多个视图

#### 3.4.4 实时验证

设计器实时验证配置的有效性：
- 视图名称检查：不能为空，不能与现有表/视图冲突
- 关联条件检查：至少配置一个有效的关联条件
- 输出列检查：至少选择一个输出列
- 字段重复检测：检测输出列是否有重名
- 表切换确认：切换表时检查字段是否失效

#### 3.4.5 快捷键

| 快捷键 | 功能 |
|--------|------|
| Enter | 保存视图 |
| Esc | 关闭设计器 |
| / | 聚焦到字段搜索框 |

#### 3.4.6 预览功能

实时预览 JOIN 结果：
- 显示输出行数
- 显示匹配行数
- 显示左表未匹配行数
- 显示右表未匹配行数
- 显示视图依赖链
- 显示视图更新时间

---

### 3.5 过滤规则引擎

#### 3.5.1 功能概述

强大的规则引擎，支持多种过滤条件、逻辑组合和正则表达式。

#### 3.5.2 规则类型

| 规则类型 | 语法 | 示例 | 说明 |
|---------|------|------|------|
| 精确匹配 | `key=value` | `Status=Shipped` | 字段完全相等 |
| 精确不等 | `key!=value` | `Status!=Pending` | 字段不等于 |
| 包含匹配 | `字段:文本` | `Msg:Error` | 字段包含指定文本（忽略大小写） |
| 数值大于 | `字段>数字` | `Stock>0` | 数值比较 |
| 数值大于等于 | `字段>=数字` | `Score>=60` | 数值比较 |
| 数值小于 | `字段<数字` | `Price<100` | 数值比较 |
| 数值小于等于 | `字段<=数字` | `Qty<=10` | 数值比较 |
| 正则表达式 | `/pattern/` | `/timeout|error/` | 标准正则语法（忽略大小写） |
| OR 组合 | `条件1\|条件2` | `Status:Shipped\|Status:Delivered` | 满足任一条件 |
| AND 组合 | `条件1 条件2` | `Status=Shipped Qty>5` | 同时满足所有条件 |

#### 3.5.3 规则作用范围

| 规则类型 | 作用范围 | 优先级 |
|---------|----------|--------|
| 全局过滤 | 所有表（包括 JOIN 视图） | 最高 |
| 列过滤 | 单个列，包含匹配 | 高 |
| 行过滤 | 目标表，隐藏不符合条件的行 | 中 |
| 高亮规则 | 目标表，标记行为黄色 | 低 |
| 仅显示高亮行 | 目标表，只显示高亮行 | 最低 |

#### 3.5.4 规则执行顺序

1. **全局过滤**：首先应用全局过滤到所有行
2. **列过滤**：对每列应用包含过滤
3. **行过滤**：对目标表应用行过滤
4. **高亮规则**：对目标表应用高亮规则
5. **仅显示高亮行**：如果启用，只显示高亮行

#### 3.5.5 特殊功能

**智能数值检测**：
- 自动检测字段值是否为数值
- 数值比较时自动转换类型
- 支持整数和小数

**正则表达式支持**：
- 标准JavaScript正则语法
- 不区分大小写
- 支持复杂模式匹配

**逻辑运算**：
- 空格表示 AND（所有条件都要满足）
- 竖线 `|` 表示 OR（任一条件满足即可）
- 支持嵌套组合

---

### 3.6 导出模块（Exporter）

#### 3.6.1 功能概述

生成 Excel 文件和 JSON 配置文件，支持多种导出选项。

#### 3.6.2 导出类型

| 导出类型 | 说明 | 适用场景 |
|---------|------|----------|
| 导出原始 | 将解析出的原始表批量导出为 Excel | 需要原始数据备份 |
| 导出预览 Excel | 导出当前预览（包含过滤、高亮、聚焦列、JOIN 结果） | 生成最终报表 |
| 导出页签 | 备份所有标签页的原始数据与 UI 状态 | 完整备份，可恢复 |
| 导出配置 | 仅同步配置（全局视图 + 各标签规则），不覆盖原始数据 | 在不同数据间共享规则 |

#### 3.6.3 Excel 导出特性

**格式支持**：
- 标准 Office Open XML 格式 (.xlsx)
- 符合 OOXML 规范
- 兼容 Excel、WPS 等软件

**智能类型检测**：
- 自动检测数值类型
- 检测前导零，防止丢失
- 空值处理

**Sheet 页命名**：
- 自动清理特殊字符
- 避免重名冲突
- 限制长度为 31 字符

**文件命名**：
- 包含精确到秒的时间戳
- 避免重名冲突
- 格式：`前缀_YYYYMMDD_HHMMSS.xlsx`

#### 3.6.4 JSON 导出特性

**文件类型标识**：
- `kind: table-tool-tabs`：标签页备份
- `kind: table-tool-config`：配置同步
- `kind: join-view`：单个视图
- `kind: join-views`：多个视图

**数据完整性**：
- 保留所有 UI 配置
- 保留时间戳
- 保留规则设置

---

### 3.7 主应用控制器（App）

#### 3.7.1 功能概述

主应用程序控制器，协调所有模块工作，处理用户交互。

#### 3.7.2 核心职责

**数据流程管理**：
1. 接收用户输入
2. 调用 Parser 解析
3. 应用过滤规则
4. 执行 JOIN 视图
5. 渲染结果表格

**用户交互处理**：
- 单元格选择和复制
- 单元格内联编辑
- 列过滤弹出窗口
- 表格折叠/展开
- 模态对话框管理

**状态同步**：
- 规则输入同步
- 视图启用同步
- 表选择同步
- 主题切换同步

---

## 4. 用户界面设计

### 4.1 整体布局

```
┌───────────────────────────────────────────────────────────────┐
│  顶部导航栏                                                    │
│  [标签1] [标签2] [标签3] ...  [＋]  [◑]  [导出预览 Excel]     │
├──────────┬────────────────────────────────────────────────────┤
│          │                                                    │
│  侧边栏  │                    预览区域                         │
│          │                                                    │
│  ┌─────┐ │  ┌──────────────────────────────────────────────┐ │
│  │数据源│ │  │ 表1: Inventory                    Row:4 Show:4│ │
│  │输入 │ │  │ ┌──────────────────────────────────────────┐ │ │
│  │     │ │  │ │ID   Product    Category  Stock   Price   │ │ │
│  │     │ │  │ │1001 Widget_A   Hardware  50      10.50   │ │ │
│  └─────┘ │  │ │1002 Widget_B   Hardware  0       25.00   │ │ │
│          │  │ └──────────────────────────────────────────┘ │ │
│  [解析]  │  └──────────────────────────────────────────────┘ │
│  [清空]  │                                                    │
│    ⭐    │  ┌──────────────────────────────────────────────┐ │
│          │  │ 表2: Orders                       Row:4 Show:4│ │
│  ┌─────┐ │  │ ┌──────────────────────────────────────────┐ │ │
│  │配置 │ │  │ │OrderID CustID ProdID  Qty    Status      │ │ │
│  │规则 │ │  │ │5001    C001    1001    5      Shipped     │ │ │
│  │     │ │  │ │5002    C002    1003    1      Pending     │ │ │
│  └─────┘ │  │ └──────────────────────────────────────────┘ │ │
│          │  └──────────────────────────────────────────────┘ │
│ [折叠]  │                                                    │
└──────────┴────────────────────────────────────────────────────┘
```

### 4.2 侧边栏面板

#### 4.2.1 数据源面板

**组件**：
- 多行文本输入框
- 拖拽调整高度（120px - 600px）
- 浮动操作按钮组

**操作按钮**：
- 解析：执行数据解析
- 清空：清空输入内容
- ⭐：加载示例数据
- 📊：导出原始表
- ⬇：导出页签
- ⬆：导入页签

#### 4.2.2 配置规则面板

**手风琴式分组**：

**1. 视图设置**
- 显示原始表：选择要显示的原始表（默认全显）
- 启用 JOIN 视图：选择要启用的 JOIN 视图
- 管理按钮：打开 JOIN 视图管理器

**2. 规则引擎**
- 配置目标表：选择要配置规则的表
- 关注列 / 显示列：输入或选择要显示的列
- 高亮规则：输入高亮条件（带帮助提示）
- 行过滤：输入行过滤条件
- 全局过滤：输入全局搜索条件
- 启用高亮渲染：勾选框，控制是否显示高亮
- 仅显示高亮行：勾选框，只显示高亮行

**3. 导出选项**
- 仅导出勾选表：勾选框
- 导出列选项：导出全量列 / 仅导出展示列
- 导出配置 / 导入配置：配置同步按钮

### 4.3 预览区域

#### 4.3.1 表格卡片

**表头元信息**：
- 表名：粗体显示
- VIEW 徽章：标识 JOIN 视图
- Row: 原始行数
- Show: 显示行数
- 列过滤：显示列过滤数量（可点击清除）

#### 4.3.2 表格交互

**单元格操作**：
- **悬停显示**：长文本单元格悬停显示完整内容
- **双击编辑**：双击单元格进入编辑模式
- **拖拽选择**：鼠标拖拽选择单元格区域
- **复制操作**：Ctrl+C / ⌘+C 复制选中区域

**表头操作**：
- **点击过滤**：点击表头打开列过滤弹出窗口
- **过滤指示**：蓝点表示已过滤
- **清除过滤**：点击 × 清除该列过滤

#### 4.3.3 表格状态

**行状态**：
- 普通行：默认背景
- 高亮行：黄色背景
- 选中单元格：蓝色背景
- 悬停行：浅蓝色背景

**折叠状态**：
- 展开：显示完整表格
- 折叠：只显示表头元信息
- 双击表头切换折叠/展开

### 4.4 模态对话框

#### 4.4.1 普通模态框

**用途**：
- 选择显示表
- 启用视图
- 选择列
- 确认操作

**布局**：
- 固定宽度 520px
- 最大高度 82vh
- 圆角 14px
- 居中显示

#### 4.4.2 全屏 JOIN 设计器

**布局**：
- 宽度：min(1200px, 94vw)
- 高度：88vh
- 三列布局：左表字段 / 关联条件 / 右表字段
- 响应式设计

**背景**：
- 半透明深色背景
- 毛玻璃效果（backdrop-filter）

#### 4.4.3 列过滤弹出窗口

**特性**：
- 固定定位
- 自动定位到表头下方
- 边界检测，防止超出屏幕
- 点击外部自动关闭
- ESC 键关闭

### 4.5 主题系统

#### 4.5.1 主题类型

| 主题 | 适用场景 |
|------|----------|
| 亮色 | 白天使用，更清晰 |
| 暗色 | 夜间使用，护眼 |

#### 4.5.2 设计令牌（Design Tokens）

**颜色系统**：
- `--primary`：主色调
- `--primary-hover`：主色调悬停
- `--primary-soft`：主色调浅色背景
- `--bg-app`：应用背景
- `--bg-card`：卡片背景
- `--bg-elevated`：提升元素背景
- `--border`：边框颜色
- `--border-strong`：强边框颜色
- `--text-strong`：强文本颜色
- `--text-mid`：中等文本颜色
- `--text-weak`：弱文本颜色

**间距系统**：
- `--radius-sm`：6px（小圆角）
- `--radius-md`：10px（中圆角）

**阴影系统**：
- `--shadow-xs`：小阴影
- `--shadow-md`：中阴影

#### 4.5.3 主题切换

- 点击主题按钮切换
- 自动保存到 localStorage
- 刷新后保持主题设置

---

## 5. 交互功能详解

### 5.1 单元格选择与复制

#### 5.1.1 选择机制

**选择方式**：
- 鼠标按下选择起始单元格
- 鼠标拖拽扩展选择区域
- 鼠标松开完成选择

**选择范围**：
- 仅支持同一表格内选择
- 支持跨行跨列选择
- 自动计算最小矩形范围

**视觉反馈**：
- 选中单元格使用蓝色背景
- 实时更新选择范围

#### 5.1.2 复制功能

**复制格式**：
- 同时生成 TSV 和 HTML 格式
- 自动包含表头
- 保持数据对齐

**TSV 格式**：
- 制表符分隔列
- 换行符分隔行
- 适合粘贴到 Excel

**HTML 格式**：
- 完整的 HTML 表格
- 包含边框样式
- 适合粘贴到富文本编辑器

**用户反馈**：
- Toast 提示复制的行数
- 格式：`已复制 N 行`

### 5.2 单元格内联编辑

#### 5.2.1 编辑模式

**进入编辑**：
- 双击单元格进入编辑模式
- 自动清除单元格选择状态
- 保存原始值用于取消

**编辑器样式**：
- 内联输入框
- 与单元格大小一致
- 蓝色边框标识编辑状态
- 自动聚焦并全选文本

**编辑操作**：
- Enter：提交修改
- Tab：提交修改
- Escape：取消修改
- 失焦：自动提交

#### 5.2.2 数据处理

**更新范围**：
- 更新渲染数据
- 影响后续导出
- 不修改原始输入

**长文本处理**：
- 自动设置 data-full 属性
- 超过 18 字符触发悬停显示

### 5.3 列过滤

#### 5.3.1 过滤方式

**触发方式**：
- 点击表头打开过滤弹出窗口
- 弹出窗口自动定位到表头下方

**过滤类型**：
- 包含匹配（忽略大小写）
- 支持部分关键字
- 实时过滤

#### 5.3.2 过滤状态

**视觉指示**：
- 表头文字变为主色调
- 蓝点指示已过滤
- 表头 tooltip 显示过滤内容
- 元信息区域显示过滤数量

**清除操作**：
- 点击表头的 × 清除单列过滤
- 点击元信息的"列过滤"标签清除整表过滤

### 5.4 表格折叠

#### 5.4.1 折叠状态

**触发方式**：
- 双击表头元信息区域

**状态保存**：
- 自动保存到 localStorage
- 刷新后保持折叠状态

### 5.5 拖拽功能

#### 5.5.1 输入框高度调整

**交互方式**：
- 拖拽输入框下方的调整条
- 支持鼠标拖拽
- 支持触摸拖拽

**高度限制**：
- 最小高度：120px
- 最大高度：600px

**状态保存**：
- 自动保存高度到 localStorage
- 刷新后恢复高度

#### 5.5.2 JOIN 输出列拖拽

**交互方式**：
- 拖拽列卡片移动位置
- 拖拽时半透明显示
- 放置时更新顺序

**视觉反馈**：
- 拖拽时降低透明度
- 光标变为抓取状态

---

## 6. 导入导出功能

### 6.1 导出功能

#### 6.1.1 导出原始表

**功能描述**：
- 批量导出所有解析出的原始表
- 不应用任何过滤或规则
- 每个 Sheet 页对应一个原始表

**文件命名**：
- 格式：`raw_YYYYMMDD_HHMMSS.xlsx`

**适用场景**：
- 原始数据备份
- 数据迁移
- 离线分享

#### 6.1.2 导出预览 Excel

**功能描述**：
- 导出当前预览显示的内容
- 包含所有过滤、高亮、聚焦列效果
- 包含启用的 JOIN 视图

**导出选项**：
- 仅导出勾选表
- 导出全量列 / 仅导出展示列

**文件命名**：
- 格式：`preview_YYYYMMDD_HHMMSS.xlsx`

**适用场景**：
- 生成最终报表
- 分享分析结果
- 存档分析过程

#### 6.1.3 导出页签

**功能描述**：
- 导出所有标签页的完整数据
- 包含原始数据 + UI 配置
- 可完全恢复工作状态

**文件格式**：
- JSON 格式
- 包含 `kind: table-tool-tabs` 标识

**文件命名**：
- 格式：`tabs_YYYYMMDD_HHMMSS.json`

**适用场景**：
- 完整工作备份
- 跨设备迁移
- 长期存档

#### 6.1.4 导出配置

**功能描述**：
- 仅导出配置（不包含原始数据）
- 包含全局视图 + 各标签规则
- 可在不同数据集上复用

**文件格式**：
- JSON 格式
- 包含 `kind: table-tool-config` 标识

**文件命名**：
- 格式：`config_YYYYMMDD_HHMMSS.json`

**适用场景**：
- 规则模板分享
- 团队协作
- 配置版本管理

### 6.2 导入功能

#### 6.2.1 导入页签

**功能描述**：
- 导入之前导出的页签文件
- 可选择覆盖或追加

**导入选项**：
- 覆盖现有：替换所有标签页
- 追加：添加到现有标签页

**文件验证**：
- 检查 `kind: table-tool-tabs` 标识
- 验证 JSON 格式

#### 6.2.2 导入配置

**功能描述**：
- 导入配置文件到当前数据
- 智能匹配文档（优先按标题匹配）
- 支持创建新文档

**匹配逻辑**：
1. 优先按标题匹配文档
2. 标题不匹配时按 ID 匹配
3. 无法匹配的配置询问是否创建新文档

**导入效果**：
- 全局视图：直接更新
- 文档规则：匹配到文档则更新，否则创建新文档

**用户反馈**：
- 显示更新统计信息
- 显示无法匹配的配置列表
- Toast 提示导入结果

---

## 7. 高级功能

### 7.1 视图管理器

#### 7.1.1 视图列表

**显示信息**：
- 视图名称
- JOIN 类型
- 左右表名
- 字段数量
- 更新时间

**列表操作**：
- 单选/多选视图
- 搜索过滤视图
- 批量操作

#### 7.1.2 单个视图操作

**编辑**：
- 打开 JOIN 设计器
- 加载视图配置
- 保存后更新

**复制**：
- 创建视图副本
- 自动生成唯一名称
- 格式：`原名称_copy`

**导出**：
- 导出单个视图配置
- JSON 格式
- 包含 `kind: join-view` 标识

**删除**：
- 二次确认
- 删除后从列表移除
- 自动更新相关配置

#### 7.1.3 批量操作

**批量导出**：
- 导出多个视图配置
- JSON 格式
- 包含 `kind: join-views` 标识

**批量删除**：
- 二次确认
- 显示删除数量
- 自动更新相关配置

#### 7.1.4 配置导入

**粘贴导入**：
- 粘贴 JSON 配置
- 支持多种格式
- 自动识别配置类型

**智能处理**：
- 名称冲突时询问
- 自动改名或覆盖
- 显示导入数量

### 7.2 多标签页管理

#### 7.2.1 标签页操作

**创建标签页**：
- 点击顶部 + 按钮
- 自动生成标题
- 自动保存

**切换标签页**：
- 点击标签页名称
- 自动保存当前标签页状态
- 加载目标标签页状态

**关闭标签页**：
- 点击标签页的 × 按钮
- 至少保留一个标签页
- 删除前自动切换到相邻标签页

#### 7.2.2 标签页状态

**独立状态**：
- 每个标签页独立的数据源
- 每个标签页独立的规则配置
- 每个标签页独立的视图设置

**共享配置**：
- 全局视图在所有标签页共享
- 主题设置在所有标签页共享

### 7.3 示例数据

#### 7.3.1 示例内容

**包含表格**：
1. Inventory（库存表）
2. Orders（订单表）
3. SystemLogs（系统日志表）

**数据设计**：
- 包含多种数据类型
- 包含关联关系
- 包含不同状态值

#### 7.3.2 加载方式

- 点击侧边栏的 ⭐ 按钮
- 自动填充到输入框
- 自动执行解析

---

## 8. 用户帮助与反馈

### 8.1 提示系统

#### 8.1.1 工具提示（Tooltip）

**触发方式**：
- 悬停在带问号的图标上

**显示内容**：
- 语法帮助
- 功能说明
- 快捷键提示

#### 8.1.2 Toast 通知

**触发场景**：
- 操作成功
- 操作失败
- 状态变化

**显示时长**：
- 成功：2 秒
- 错误：手动关闭

#### 8.1.3 空状态提示

**显示场景**：
- 无数据时
- 无搜索结果时
- 无可用选项时

**提示内容**：
- 图标提示
- 文字说明
- 操作指引

### 8.2 快捷键

#### 8.2.1 全局快捷键

| 快捷键 | 功能 | 适用范围 |
|--------|------|----------|
| Ctrl+C / ⌘+C | 复制选中单元格 | 预览区域 |
| Escape | 关闭弹出窗口/取消操作 | 全局 |

#### 8.2.2 JOIN 设计器快捷键

| 快捷键 | 功能 |
|--------|------|
| Enter | 保存视图 |
| Escape | 关闭设计器 |
| / | 聚焦到字段搜索框 |

---

## 9. 性能考虑

### 9.1 性能限制

**建议数据量**：
- 单表不超过 10,000 行
- 总数据量不超过 50MB
- 总单元格数不超过 500,000

**浏览器限制**：
- localStorage 容量：5-10MB
- 建议定期导出备份

### 9.2 性能优化

**数据处理**：
- 使用哈希索引加速 JOIN
- 延迟渲染表格
- 虚拟滚动（未来版本）

**内存管理**：
- 及时清理大对象
- 使用弱引用（未来版本）

---

## 10. 浏览器兼容性

### 10.1 支持的浏览器

| 浏览器 | 最低版本 | 说明 |
|--------|---------|------|
| Chrome | 90+ | 推荐 |
| Edge | 90+ | 完全支持 |
| Firefox | 88+ | 完全支持 |
| Safari | 14+ | 完全支持 |
| Opera | 76+ | 完全支持 |

### 10.2 不支持的浏览器

- Internet Explorer（已停止官方支持）

---

## 11. 安全与隐私

### 11.1 数据安全

**本地处理**：
- 所有数据处理在本地浏览器完成
- 不发送任何数据到服务器
- 不依赖任何网络资源

**存储安全**：
- 数据存储在浏览器 localStorage
- 不自动上传到云端
- 清除浏览器数据会删除所有内容

### 11.2 隐私保护

**无追踪**：
- 不收集用户信息
- 不进行使用统计
- 不嵌入第三方代码

**离线运行**：
- 无需网络连接
- 无远程资源加载
- 完全离线可用

---

## 12. 未来扩展方向

### 12.1 功能增强

- 支持更多数据格式（JSON、XML 等）
- 支持图表可视化
- 支持数据透视表
- 支持宏和脚本

### 12.2 性能优化

- 虚拟滚动支持大数据量
- Web Worker 后台处理
- 增量渲染

### 12.3 用户体验

- 更多主题选项
- 自定义快捷键
- 拖拽排序标签页
- 撤销/重做功能

---

## 13. 术语表

| 术语 | 说明 |
|------|------|
| 原始表 | 从数据源解析出的表格数据 |
| JOIN 视图 | 通过 JOIN 操作生成的虚拟表 |
| 目标表 | 当前配置规则所应用的表 |
| 聚焦列 | 只显示指定的列 |
| 列过滤 | 对单列进行包含匹配过滤 |
| 行过滤 | 隐藏不符合条件的行 |
| 高亮规则 | 标记符合条件的行为黄色 |
| 全局过滤 | 作用于所有表的过滤条件 |
| 标签页 | 独立的分析工作区 |
| 侧边栏 | 左侧配置面板 |
| 预览区域 | 右侧数据展示区域 |

---

## 附录

### A. 过滤规则语法完整示例

```
# 精确匹配
Status=Shipped
Category=Electronics

# 精确不等
Status!=Pending
Level!=INFO

# 包含匹配
Msg:Error
Message:timeout

# 数值比较
Stock>0
Price<=100
Score>=60
Qty<10

# 正则表达式
/ERROR|WARN|CRITICAL/

# OR 组合
Status:Shipped|Status:Delivered
Level:ERROR|Level:CRITICAL

# AND 组合
Status=Shipped Qty>5
Category=Electronics Price>100

# 复杂组合
Status:Shipped|Status:Delivered Qty>10
Level:ERROR|Level:CRITICAL Message:timeout
```

### B. JOIN 视图配置示例

```json
{
  "view": "UserOrders",
  "left": "Users",
  "right": "Orders",
  "type": "left",
  "on": "userID=userId",
  "select": "left.userName,right.product,right.amount"
}
```

### C. 数据格式示例

```
table-data Users
validflag userID  userName  email
         1        Alice     alice@example.com
         2        Bob       bob@example.com

table-data Orders
validflag orderID  userID  product  amount
         101       1       Widget   50
         102       1       Gadget   100
         103       3       Tool     75
```

---

**文档结束**
