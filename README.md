# 离线表格分析器（Smart Parser）· v17.0

> 单页、纯前端的表格解析 / 过滤 / 联表工具，零依赖、开箱即用，适合在没有后台或外网的环境快速排查和导出数据。

[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)

## 核心价值

- **快速排查日志**：从服务器复制日志文本，直接过滤、高亮、JOIN 关联表，无需写 SQL
- **数据对比**：对比两个时间点的快照数据，找出差异行
- **临时报表**：快速从文本数据生成 Excel 报表，支持多表关联
- **完全离线**：不依赖任何网络服务，数据完全在本地浏览器处理，安全可控

## 功能特性

- **纯前端离线运行**：仅需双击 `index.html` 即可使用，无需安装、无后端依赖
- **多格式解析**：根据输入自动识别制表符、逗号、空格/定宽表头等格式，将文本快速拆解为多张表
- **多标签页会话**：支持在一个浏览器里同时保存多份数据源与配置，状态持久化到 localStorage
- **预览与交互**：表格可折叠、列宽自适应，长文本悬停可看全量；可拖拽选择单元格并复制为 TSV/HTML
- **过滤与高亮**：全局过滤 + 表级过滤 + 高亮规则，支持比较/包含/正则/OR 语法，可切换"仅显示高亮行"
- **列筛选与聚焦**：点击表头即可按列过滤；可选择"关注列 / 显示列"让预览与导出只保留关键列
- **JOIN 视图**：内置 Join Designer，支持配置 inner/left join、字段映射、输出列顺序与别名，可递归引用其他视图
- **导出与备份**：一键导出原始表或当前预览为 Excel，并可导入/导出页签与配置 JSON 做备份或迁移
- **主题与快捷操作**：亮/暗主题切换；Join 设计器支持键盘快捷键，预览支持双击编辑

## 快速开始

```bash
# 克隆仓库
git clone https://github.com/yourusername/parse_dim_tool.git
cd parse_dim_tool

# 直接在浏览器打开（无需服务器）
# Windows: 双击 index.html
# Mac/Linux: open index.html
```

**五步上手流程**：

1. **粘贴数据**：在左侧"数据源"粘贴表格文本，或点击 ⭐ 载入示例数据
2. **解析表格**：点击"解析"按钮，右侧会生成各张表的预览卡片
3. **配置规则**：设定目标表、高亮规则、行过滤、全局过滤，或选择关注列
4. **联表查询**（可选）：点击"管理"进入 Join Designer，配置完成后在"启用 JOIN 视图"中勾选
5. **导出结果**：通过顶部"导出预览 Excel"或侧栏"导出原始"导出结果

## 数据格式要求

### 标准格式

每张表必须符合以下格式：

```text
table-data <表名>
validflag <列名1>    <列名2>    <列名3>
<数据1>    <数据2>    <数据3>
```

**关键规则**：
- 每张表以 `table-data <表名>` 起始
- 下一行**必须**以 `validflag` 开头作为表头（这是解析标志）
- 表头行支持：制表符(TAB)、逗号、空格分隔或定宽格式（自动推断）
- 数据行按表头列数解析
- 遇到空行或以 `<` / `[` 开头的行结束当前表
- 同一输入可包含多张表，表名及列名大小写按原样保留

### 完整示例

```text
table-data Inventory
validflag ID      Product       Category    Stock   Price
         1001    Widget_A      Hardware    50      10.50
         1002    Widget_B      Hardware    0       25.00
         1003    Gadget_C      Electronics 120     89.99

table-data Orders
validflag OrderID CustID  ProdID  Qty   Status
         5001    C001    1001    5     Shipped
         5002    C002    1002    10    Pending
         5003    C001    1003    2     Delivered
```

**提示**：点击界面左侧的"⭐"按钮可自动加载上述示例数据进行体验。

### 支持的数据格式

| 格式 | 示例 | 说明 |
|------|------|------|
| 制表符分隔 | `ID\tName\tAge` | 推荐格式，从 Excel 复制时自动使用 |
| 逗号分隔 | `ID,Name,Age` | 标准 CSV 格式 |
| 空格分隔 | `ID Name Age` | 自动识别列边界 |
| 定宽格式 | `ID    Name      Age` | 自动推断列范围（需要表头对齐） |

## 过滤与高亮规则详解

### 作用范围

- **全局过滤**：作用于所有表（包括 JOIN 视图）
- **行过滤**：作用于当前"配置目标表"，隐藏不符合条件的行
- **高亮规则**：作用于当前"配置目标表"，标记符合条件的行为黄色
- **仅显示高亮行**：勾选后只显示高亮行，快速定位关键数据

### 语法规则

不区分大小写，**空格代表 AND**，**`|` 代表 OR**。

| 类型 | 语法 | 示例 | 说明 |
|------|------|------|------|
| 精确匹配 | `key=value` | `Status=Shipped` | 字段完全相等 |
| 精确不等 | `key!=value` | `Status!=Pending` | 字段不等于 |
| 包含匹配 | `字段:文本` | `Msg:Error` | 字段包含指定文本 |
| 数值大于 | `字段>数字` | `Stock>0` | 数值比较（支持 >, >=, <, <=） |
| 正则表达式 | `/pattern/` | `/timeout\|error/` | 支持标准正则语法 |
| OR 组合 | `条件1\|条件2` | `Status:Shipped\|Status:Delivered` | 满足任一条件 |
| AND 组合 | `条件1 条件2` | `Status=Shipped Qty>5` | 同时满足所有条件 |

### 实战示例

**场景 1：日志排查**
```
# 查找所有错误或超时的日志
/ERROR|TIMEOUT/

# 查找特定用户的错误日志
User=admin Msg:ERROR

# 查找响应时间超过 1000ms 的请求
Duration>1000
```

**场景 2：库存管理**
```
# 查找库存不足的商品
Stock<10 Category=Hardware

# 高亮缺货商品（配合"仅显示高亮行"使用）
Stock=0

# 查找特定类别且价格过高的商品
Category:Electronics Price>100
```

**场景 3：订单筛选**
```
# 查找已发货或已送达的订单
Status:Shipped|Status:Delivered

# 查找数量大于 5 的待处理订单
Status=Pending Qty>5

# 组合条件：特定客户的高价值订单
CustID=C001 Qty>10 Status=Pending
```

### 列过滤与聚焦

- **列过滤**：点击表头弹出输入框，按列进行包含过滤
  - 有蓝点表示该列已过滤
  - 点击 `×` 可清除单列过滤
  - 表头元信息里的"列过滤"标签可一键清空所有列过滤

- **列聚焦**：在"关注列 / 显示列"输入列名或点击"选择"勾选列
  - 只展示并导出所选列，便于比对关键数据
  - 支持手动输入列名（用空格分隔）
  - 支持从下拉列表中勾选

## JOIN 视图设计器

### 基础用法

1. 点击"管理"按钮打开 Join Designer
2. 点击"新增视图"创建新的 JOIN 配置
3. 设置以下参数：
   - **视图名称**：自定义名称（建议前缀加 `JOIN:` 以便区分）
   - **左表 / 右表**：选择要关联的表（可以是原始表或其他视图）
   - **Join 类型**：
     - `Inner Join`：只保留匹配成功的行
     - `Left Join`：保留左表所有行，右表不匹配的列为空
   - **ON 条件**：添加匹配字段（如 `id=userId`）
4. 在中间输出区：
   - 拖拽调整列顺序
   - 设置列别名（如 `left.userName AS 姓名`）
   - 选择要输出的列
5. 点击"保存"完成配置

### 高级功能

- **字段自动匹配**：点击"自动匹配"按钮，自动识别相同名称的字段
- **左右互换**：快速交换左表和右表
- **搜索字段**：在字段列表中输入关键词快速定位
- **仅看已选**：只显示已选择的字段，简化界面
- **递归引用**：视图可以引用其他视图（自动阻止循环依赖）
- **导入配置**：通过"粘贴配置 (JSON)"快速导入已导出的视图配置

### JOIN 示例

假设有两张表：

```text
table-data Users
validflag userID  userName  email
         1        Alice     alice@example.com
         2        Bob       bob@example.com

table-data Orders
validflag orderID  userID  product  amount
         101       1       Widget   50
         102       1       Gadget   100
         103       3       Tool     75
```

**Inner Join 配置**（只匹配有订单的用户）：
- 左表：`Users`
- 右表：`Orders`
- ON 条件：`userID=userID`
- 输出列：`userName`, `product`, `amount`

**结果**：
```
userName  product  amount
Alice     Widget   50
Alice     Gadget   100
```
（Bob 没有订单不显示，orderID 103 的用户 ID 3 不存在也不显示）

**Left Join 配置**（显示所有用户，包括没有订单的）：
- 左表：`Users`
- 右表：`Orders`
- ON 条件：`userID=userID`

**结果**：
```
userName  product  amount
Alice     Widget   50
Alice     Gadget   100
Bob       (空)     (空)
```

### 使用 JOIN 视图

1. 保存视图后，在主界面的"启用 JOIN 视图"下拉列表中勾选该视图
2. JOIN 视图会与原始表一起显示在预览区
3. 可以对 JOIN 视图应用过滤、高亮、列聚焦等规则
4. 导出时会包含所有启用的 JOIN 视图

## 导出与备份

### 导出选项

| 导出类型 | 说明 | 适用场景 |
|---------|------|---------|
| **导出原始** | 将解析出的原始表批量导出为 Excel | 需要原始数据备份 |
| **导出预览 Excel** | 导出当前预览（包含过滤、高亮、聚焦列、JOIN 结果） | 生成最终报表 |
| **导出页签** | 备份所有标签页的原始数据与 UI 状态 | 完整备份，文件含 `kind: table-tool-tabs` |
| **导出配置** | 仅同步配置（全局视图 + 各标签的规则），不覆盖原始数据 | 在不同数据间共享规则，文件含 `kind: table-tool-config` |

### 导出格式说明

- **Excel (.xlsx)**：标准的 Office Open XML 格式，可用 Excel、WPS 等打开
- **JSON 配置**：用于备份和迁移，可通过"导入"功能恢复

### 使用建议

- **日常使用**：使用"导出预览 Excel"生成报表
- **数据备份**：定期使用"导出页签"保存完整状态
- **规则复用**：将常用规则保存为配置，在其他数据上导入使用
- **团队协作**：导出配置分享给团队成员，统一分析规则

## 操作技巧与快捷键

### 表格操作

- **复制单元格**：拖动选择单元格区域，按 `Ctrl+C` / `⌘+C` 复制（同时生成 TSV 与 HTML，包含表头）
- **内联编辑**：双击单元格可编辑预览数据（立即影响预览和导出，但不会改写左侧原始输入）
- **折叠/展开**：双击表卡片头部可折叠或展开表格
- **查看长文本**：鼠标悬停在长文本单元格上可查看完整内容

### 界面操作

- **主题切换**：点击主题按钮在亮/暗模式间切换（会自动记忆）
- **新建标签页**：点击顶部 `＋` 按钮创建新的分析会话
- **切换标签页**：点击标签页名称或使用左右箭头切换

### Join Designer 快捷键

| 快捷键 | 功能 |
|--------|------|
| `Enter` | 保存当前视图 |
| `Esc` | 关闭设计器 |
| `/` | 聚焦到字段搜索框 |

## 常见问题（FAQ）

### 解析相关

**Q: 为什么点击"解析"后没有生成表格？**

A: 请检查以下事项：
1. 确保每张表都有 `table-data <表名>` 开头
2. 确保表头行以 `validflag` 开头（这是必须的解析标志）
3. 检查表头和数据行的列数是否一致
4. 查看浏览器控制台（F12）是否有错误信息

**Q: 数据列没有对齐怎么办？**

A: 可以尝试以下方法：
1. 使用制表符（TAB）分隔数据，这是最可靠的方式
2. 如果是从 Excel 复制的，直接粘贴即可（自动使用制表符）
3. 检查数据行是否有额外的空格或特殊字符

**Q: 支持多少数据量？**

A: 理论上没有硬性限制，但受浏览器性能影响：
- **建议单表不超过 10,000 行**
- **总数据量不超过 50MB**（包括所有表）
- 超过此范围可能影响响应速度，但仍可正常使用

### 过滤相关

**Q: 为什么过滤条件没有生效？**

A: 请检查：
1. 确认"配置目标表"是否选择了正确的表
2. 检查过滤语法是否正确（注意空格是 AND，不是 OR）
3. 区分"行过滤"（隐藏行）和"高亮规则"（标记黄色）
4. 列名区分大小写，确保与表头完全一致

**Q: 如何搜索包含空格的文本？**

A: 目前不支持在过滤条件中搜索包含空格的文本。建议使用正则表达式：
```
/包含空格的文本/
```

**Q: 可以对 JOIN 视图进行过滤吗？**

A: 可以。JOIN 视图在启用后会像普通表一样显示，可以对其应用所有过滤规则。

### JOIN 相关

**Q: JOIN 结果为空怎么办？**

A: 常见原因：
1. **ON 条件的字段值不匹配**：检查两个表的字段值是否完全一致（包括空格、大小写）
2. **Inner Join 没有匹配**：尝试改为 Left Join 查看左表数据
3. **字段名称错误**：确认 ON 条件中的字段名正确
4. **数据类型不匹配**：确保关联字段的类型一致（如数字 vs 文本）

**Q: 如何调试 JOIN 配置？**

A: 建议步骤：
1. 先用 Left Join 查看所有数据
2. 在输出列中包含关联字段，对比左右值
3. 使用列过滤检查特定字段
4. 减少数据量（先用行过滤限制数据范围）进行测试

**Q: 视图可以引用其他视图吗？**

A: 可以。支持递归引用（如视图 C 引用视图 B，视图 B 引用表 A），系统会自动阻止循环依赖。

### 导出相关

**Q: 导出的 Excel 打开乱码怎么办？**

A: 工具使用标准 UTF-8 编码生成 Excel，如果出现乱码：
1. 确保使用最新版本的 Excel 或 WPS
2. 尝试在 Excel 中选择"UTF-8"编码打开
3. 如果仍无法解决，可以使用"复制为 TSV"然后粘贴到 Excel

**Q: 导出配置和导出页签有什么区别？**

A:
- **导出配置**：只保存规则（过滤条件、JOIN 配置等），不保存原始数据，适合在不同数据集上复用规则
- **导出页签**：保存所有内容（包括原始数据），适合完整备份

### 数据存储相关

**Q: 更换浏览器后数据还在吗？**

A: 不在。数据存储在浏览器的 localStorage 中，更换浏览器或清空缓存后数据会丢失。请在更换前先"导出页签"或"导出配置"。

**Q: localStorage 有容量限制吗？**

A: 大多数浏览器限制为 5-10MB。如果数据量较大：
1. 定期导出页签到本地文件
2. 删除不需要的标签页
3. 清空浏览器缓存前务必备份

**Q: 如何清除所有数据重新开始？**

A: 在浏览器控制台（F12）执行：
```javascript
localStorage.removeItem('v16_4_store')
location.reload()
```

## 浏览器兼容性

| 浏览器 | 最低版本 | 说明 |
|--------|---------|------|
| Chrome | 90+ | 推荐 |
| Edge | 90+ | 完全支持 |
| Firefox | 88+ | 完全支持 |
| Safari | 14+ | 完全支持 |
| Opera | 76+ | 完全支持 |

**注意**：不支持 IE 浏览器（IE 已停止官方支持）

## 性能优化建议

1. **大数据集处理**：
   - 使用行过滤先减少数据量
   - 使用列聚焦只显示需要的列
   - 避免同时启用多个 JOIN 视图

2. **加快响应速度**：
   - 关闭不需要的标签页
   - 定期清理 localStorage（导出后清除旧数据）
   - 使用现代浏览器（Chrome/Edge）

3. **内存占用**：
   - 单次会话建议处理不超过 100MB 数据
   - 超过 50,000 行建议分批处理

## 项目结构

```
parse_dim_tool/
├── index.html          # 单页应用（包含所有 HTML/CSS/JS）
├── README.md           # 项目文档
└── CLAUDE.md           # 开发者指南
```

**架构说明**：
- 整个应用只有这一个 `index.html` 文件（约 2,500 行代码）
- 所有样式（CSS）内嵌在 `<style>` 标签中
- 所有逻辑（JavaScript）内嵌在 `<script>` 标签中
- 无任何外部依赖，无网络请求
- 支持 localStorage 持久化存储

## 技术栈

- **纯 HTML5 + CSS3 + Vanilla JavaScript**
- **无框架**：不依赖 React、Vue、jQuery 等任何第三方库
- **自定义 Excel 导出**：手写的 ZIP/OOXML 实现
- **LocalStorage API**：数据持久化

## 开发与贡献

欢迎提交 Issue 和 Pull Request！

### 本地开发

```bash
# 克隆仓库
git clone https://github.com/yourusername/parse_dim_tool.git
cd parse_dim_tool

# 直接在浏览器打开（无需构建）
open index.html

# 或使用本地服务器（推荐）
python -m http.server 8000
# 访问 http://localhost:8000
```

### 代码规范

- 保持单文件结构（所有代码在 `index.html`）
- 使用中文注释和 UI 文本
- 代码模块化：Store、Parser、Joiner、Exporter、App
- 更新 localStorage 版本号时需考虑向后兼容

## 许可证

MIT License - 详见 [LICENSE](LICENSE) 文件

## 更新日志

### v17.0 (当前版本)
- 完整的 JOIN 视图支持
- 列过滤和聚焦功能
- 多标签页管理
- 亮/暗主题切换
- Excel/TSV/HTML 多格式导出

### 历史版本
详见 Git 提交历史

## 反馈与支持

- **问题反馈**：[GitHub Issues](https://github.com/yourusername/parse_dim_tool/issues)
- **功能建议**：欢迎提交 Issue 或 Pull Request
- **使用咨询**：请在 Issues 中详细描述问题场景

---

**💡 提示**：第一次使用？点击界面左侧的"⭐"按钮加载示例数据快速上手！
